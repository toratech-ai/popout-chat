!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MyPopoutWidget=e()}(this,(function(){"use strict";
/**
   * Toratech AI Chat Widget - Constants
   * @version 1.0.0
   * @license MIT
   */const t="ToratechAIChat",e="ChatWidgetConfig",n="toratech-chat-widget",o={branding:{logo:"https://cdn.toratech.com/assets/default-logo.png",name:"Toratech AI Support",welcomeText:"Hi there! ðŸ‘‹ How can I assist you today?",responseTimeText:"We typically respond quickly.",poweredBy:{text:"Powered by Toratech AI",link:"https://toratech.ai"}},style:{primaryColor:"#338AFF",secondaryColor:"#2072E8",position:"right",backgroundColor:"#ffffff",fontColor:"#333333",userBubbleColor:"",botBubbleColor:"#f0f0f0"},webhook_url:"",webhook_route:""};function a(...t){const e={};for(const n of t)if(n)for(const t in n)n.hasOwnProperty(t)&&("object"!=typeof n[t]||null===n[t]||Array.isArray(n[t])?e[t]=n[t]:e[t]=a(e[t]||{},n[t]));return e}function r(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"tt_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}function i(t,e,n,o){if(!t)return void(o&&o("Messages container not found for addMessageToDisplay","error"));const a=document.createElement("div");a.classList.add("chat-message",n),a.textContent=e,t.appendChild(a),t.scrollTop=t.scrollHeight,o&&o(`Message added to UI: "${e}" as ${n}`)}async function c(t,e,n,o,a){if(!e.trim())return;o&&o(`Sending message: ${e}`),n(t.messagesContainer,e,"user",o);const r=document.createElement("div");if(r.className="bot-typing",r.innerHTML='\n    <span class="loading-indicator"></span>\n    <span>Toratech AI is typing...</span>\n  ',t.messagesContainer.appendChild(r),t.messagesContainer.scrollTop=t.messagesContainer.scrollHeight,a&&a.webhook_url){o&&o("Sending message to webhook: "+a.webhook_url);try{const i={action:"sendMessage",sessionId:a.currentSessionId||"default-session",route:a.webhook_route||"general",chatInput:e,metadata:{userId:""}},c=await fetch(a.webhook_url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(t.messagesContainer.contains(r)&&t.messagesContainer.removeChild(r),!c.ok)throw new Error(`Webhook responded with status: ${c.status}`);const s=await c.json();let d="";d=Array.isArray(s)&&s.length>0?s[0].output:s.output?s.output:"string"==typeof s?s:s.message||s.response||s.text||s.content||JSON.stringify(s),n(t.messagesContainer,d,"bot",o),o&&o("Received response from webhook")}catch(i){t.messagesContainer.contains(r)&&t.messagesContainer.removeChild(r),o&&o("Error sending message to webhook: "+i.message,"error"),n(t.messagesContainer,"Sorry, I couldn't connect to the chat service. Please try again later.","bot",o)}}else setTimeout((()=>{t.messagesContainer.contains(r)&&t.messagesContainer.removeChild(r),n(t.messagesContainer,`You said: "${e}". This is a demo response from Toratech AI.`,"bot",o)}),1500)}
/**
   * Toratech AI Chat Widget
   * A lightweight, embeddable chat widget for customer support
   * @version 1.0.0
   * @license MIT
   */let s="",d=null,l={...o},h=!1;function g(t,e="info"){!function(t,e="info",n){var o;(null==(o=null==n?void 0:n.advanced)?void 0:o.debug)&&console["error"===e?"error":"log"](`[Toratech AI Chat] ${t}`)}(t,e,l)}function p(t){s=t}function u(t){return h?(g("Widget already initialized"),d):(t&&(l=a({},l,t)),g("Initializing widget"),function(t,e,n,o){if(document.getElementById(n))return;const a=document.createElement("style");a.id=n,a.textContent=e,document.head.appendChild(a),o&&o("Styles injected")}(0,".toratech-chat-widget {\n    --chat-color-primary: var(--toratech-chat-primary-color, #0066cc);\n    --chat-color-secondary: var(--toratech-chat-secondary-color, #004d99);\n    --chat-color-background: var(--toratech-chat-background-color, #ffffff);\n    --chat-color-font: var(--toratech-chat-font-color, #333333);\n    --chat-color-user-bubble: var(--toratech-chat-user-bubble-color, var(--chat-color-primary));\n    --chat-color-bot-bubble: var(--toratech-chat-bot-bubble-color, #f0f0f0);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n  }\n\n  .toratech-chat-widget .chat-container {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    z-index: 9999;\n    display: none;\n    flex-direction: column;\n    width: 520px;\n    height: 715px;\n    max-height: 80vh;\n    background-color: var(--chat-color-background);\n    border-radius: 10px;\n    box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);\n    overflow: hidden;\n    transition: all 0.3s ease;\n    opacity: 0;\n    transform: translateY(20px);\n  }\n\n  .toratech-chat-widget .chat-container.position-left {\n    right: auto;\n    left: 20px;\n  }\n\n  .toratech-chat-widget .chat-container.open {\n    display: flex;\n    opacity: 1;\n    transform: translateY(0);\n  }\n\n  .toratech-chat-widget .brand-header {\n    display: flex;\n    align-items: center;\n    padding: 15px;\n    background-color: var(--chat-color-primary);\n    color: white;\n  }\n\n  .toratech-chat-widget .brand-header img {\n    width: 24px;\n    height: 24px;\n    margin-right: 10px;\n    border-radius: 50%;\n  }\n\n  .toratech-chat-widget .brand-header span {\n    flex-grow: 1;\n    font-weight: 600;\n  }\n\n  .toratech-chat-widget .close-button {\n    background: none;\n    border: none;\n    color: white;\n    font-size: 24px;\n    cursor: pointer;\n    padding: 0;\n    width: 24px;\n    height: 24px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.2s;\n  }\n\n  .toratech-chat-widget .close-button:hover {\n    transform: scale(1.1);\n  }\n\n  .toratech-chat-widget .new-conversation {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 30px;\n    flex-grow: 1;\n    text-align: center;\n  }\n\n  .toratech-chat-widget .welcome-text {\n    font-size: 18px;\n    margin-bottom: 20px;\n    color: var(--chat-color-font);\n  }\n\n  .toratech-chat-widget .new-chat-btn {\n    background-color: var(--chat-color-primary);\n    color: white;\n    border: none;\n    border-radius: 20px;\n    padding: 10px 20px;\n    font-size: 14px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    transition: background-color 0.2s;\n  }\n\n  .toratech-chat-widget .new-chat-btn:hover {\n    background-color: var(--chat-color-secondary);\n  }\n\n  .toratech-chat-widget .message-icon {\n    width: 16px;\n    height: 16px;\n    margin-right: 8px;\n  }\n\n  .toratech-chat-widget .response-text {\n    margin-top: 15px;\n    font-size: 13px;\n    color: #666;\n  }\n\n  .toratech-chat-widget .chat-interface {\n    display: none;\n    flex-direction: column;\n    height: 100%;\n  }\n\n  .toratech-chat-widget .chat-interface.active {\n    display: flex;\n  }\n\n  .toratech-chat-widget .chat-messages {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .toratech-chat-widget .chat-message {\n    max-width: 80%;\n    padding: 10px 15px;\n    border-radius: 18px;\n    margin-bottom: 10px;\n    word-wrap: break-word;\n    line-height: 1.4;\n  }\n\n  .toratech-chat-widget .chat-message.user {\n    align-self: flex-end;\n    background-color: var(--chat-color-user-bubble);\n    color: white;\n    border-bottom-right-radius: 5px;\n  }\n\n  .toratech-chat-widget .chat-message.bot {\n    align-self: flex-start;\n    background-color: var(--chat-color-bot-bubble);\n    color: var(--chat-color-font);\n    border-bottom-left-radius: 5px;\n  }\n\n  .toratech-chat-widget .bot-typing {\n    align-self: flex-start;\n    background-color: var(--chat-color-bot-bubble);\n    color: var(--chat-color-font);\n    border-radius: 18px;\n    border-bottom-left-radius: 5px;\n    padding: 10px 15px;\n    margin-bottom: 10px;\n    display: flex;\n    align-items: center;\n  }\n\n  .toratech-chat-widget .loading-indicator {\n    width: 20px;\n    height: 10px;\n    margin-right: 10px;\n    position: relative;\n  }\n\n  .toratech-chat-widget .loading-indicator:before {\n    content: '';\n    position: absolute;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #888;\n    animation: typing 1s infinite;\n  }\n\n  @keyframes typing {\n    0%, 100% { transform: translateX(0); }\n    50% { transform: translateX(10px); }\n  }\n\n  .toratech-chat-widget .chat-input {\n    display: flex;\n    padding: 10px;\n    border-top: 1px solid #eee;\n    align-items: center;\n  }\n\n  .toratech-chat-widget .chat-input textarea {\n    flex-grow: 1;\n    border: 1px solid #ddd;\n    border-radius: 20px;\n    padding: 10px 15px;\n    font-size: 14px;\n    line-height: 1.4;\n    box-sizing: border-box;\n    height: 50px;\n    min-height: 50px;\n    min-width: 0;\n    resize: none;\n    font-family: inherit;\n    overflow-y: hidden;\n  }\n\n  .toratech-chat-widget .chat-input textarea:focus {\n    border-color: var(--chat-color-primary);\n    outline: none;\n  }\n\n  .toratech-chat-widget .chat-input button {\n    background-color: var(--chat-color-primary);\n    color: white;\n    border: none;\n    border-radius: 50%;\n    width: 40px;\n    height: 40px;\n    padding: 0;\n    margin-left: 10px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .toratech-chat-widget .chat-input button:hover {\n    background-color: var(--chat-color-secondary);\n  }\n\n  .toratech-chat-widget .chat-footer {\n    padding: 5px 10px;\n    text-align: center;\n    font-size: 11px;\n    color: #999;\n    border-top: 1px solid #eee;\n  }\n\n  .toratech-chat-widget .chat-footer a {\n    color: var(--chat-color-primary);\n    text-decoration: none;\n  }\n\n  .toratech-chat-widget .chat-toggle {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background-color: var(--chat-color-primary);\n    color: white;\n    border: none;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: transform 0.3s, background-color 0.3s;\n    z-index: 9998;\n  }\n\n  .toratech-chat-widget .chat-toggle.position-left {\n    right: auto;\n    left: 20px;\n  }\n\n  .toratech-chat-widget .chat-toggle:hover {\n    transform: scale(1.05);\n    background-color: var(--chat-color-secondary);\n  }\n\n  .toratech-chat-widget .chat-toggle svg {\n    width: 28px;\n    height: 28px;\n    fill: currentColor;\n  }\n\n  @media (max-width: 480px) {\n    .toratech-chat-widget .chat-container {\n      width: 100%;\n      height: 100%;\n      max-height: 100vh;\n      bottom: 0;\n      right: 0;\n      border-radius: 0;\n    }\n    \n    .toratech-chat-widget .chat-container.position-left {\n      left: 0;\n    }\n  }","toratech-chat-styles",g),d=function(t,e,n,o,a){const r=document.createElement("div");r.className=e,r.id=e,r.style.setProperty("--toratech-chat-primary-color",t.style.primaryColor),r.style.setProperty("--toratech-chat-secondary-color",t.style.secondaryColor),r.style.setProperty("--toratech-chat-background-color",t.style.backgroundColor),r.style.setProperty("--toratech-chat-font-color",t.style.fontColor),r.style.setProperty("--toratech-chat-user-bubble-color",t.style.userBubbleColor||t.style.primaryColor),r.style.setProperty("--toratech-chat-bot-bubble-color",t.style.botBubbleColor);const i=document.createElement("div");i.id=o,i.className="chat-container"+("left"===t.style.position?" position-left":"");const c=`\n    <div class="brand-header">\n      <img src="${t.branding.logo}" alt="${t.branding.name}">\n      <span>${t.branding.name}</span>\n      <button class="close-button" aria-label="Close chat" title="Close chat" tabindex="0">Ã—</button>\n    </div>\n  `,s=`\n    <div class="new-conversation">\n      <h2 class="welcome-text">${t.branding.welcomeText}</h2>\n      <button class="new-chat-btn">\n        <svg class="message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n          <path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/>\n        </svg>\n        Send us a message\n      </button>\n      <p class="response-text">${t.branding.responseTimeText}</p>\n    </div>\n  `,d=`\n    <div class="chat-interface">\n      <div class="chat-messages"></div>\n      <div class="chat-input">\n        <textarea \n          placeholder="Type your message here..." \n          rows="1"\n          aria-label="Message input"\n          tabindex="0"\n        ></textarea>\n        <button \n          type="submit"\n          aria-label="Send message"\n          title="Send message"\n          tabindex="0"\n        >\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor" style="display: block; margin: auto;">\n            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n          </svg>\n        </button>\n      </div>\n      <div class="chat-footer">\n        <a href="${t.branding.poweredBy.link}" target="_blank">${t.branding.poweredBy.text}</a>\n      </div>\n    </div>\n  `;i.innerHTML=c+s+d;const l=document.createElement("button");return l.id=n,l.className="chat-toggle"+("left"===t.style.position?" position-left":""),l.setAttribute("aria-label","Open chat"),l.setAttribute("title","Chat with Toratech AI Support"),l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">\n      <path d="M12 2C6.477 2 2 6.477 2 12c0 1.821.487 3.53 1.338 5L2.5 21.5l4.5-.838A9.955 9.955 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2zm0 18c-1.476 0-2.886-.313-4.156-.878l-3.156.586.586-3.156A7.962 7.962 0 014 12c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"/>\n    </svg>',r.appendChild(i),r.appendChild(l),document.body.appendChild(r),a&&a("Widget elements created"),{widgetContainer:r,chatContainer:i,toggleButton:l,newChatBtn:i.querySelector(".new-chat-btn"),chatInterface:i.querySelector(".chat-interface"),messagesContainer:i.querySelector(".chat-messages"),textarea:i.querySelector("textarea"),sendButton:i.querySelector('button[type="submit"]'),closeButtons:i.querySelectorAll(".close-button")}}(l,n,"toratech-chat-toggle","toratech-chat-container",g),d.toggleButton.addEventListener("click",(()=>{const t=!d.chatContainer.classList.contains("open");d.chatContainer.classList.toggle("open"),t&&(d.chatInterface.classList.contains("active")?d.textarea.focus():d.newChatBtn.focus()),g("Widget toggled via click")})),d.toggleButton.addEventListener("keydown",(t=>{if("Enter"===t.key||" "===t.key){t.preventDefault();const e=!d.chatContainer.classList.contains("open");d.chatContainer.classList.toggle("open"),e&&(d.chatInterface.classList.contains("active")?d.textarea.focus():d.newChatBtn.focus()),g("Widget toggled via keyboard")}})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&d.chatContainer.classList.contains("open")&&(d.chatContainer.classList.remove("open"),d.toggleButton.focus(),g("Widget closed via ESC key"))})),d.newChatBtn.addEventListener("click",(()=>{!async function(t,e,n,o,a){const r=e();n(r),a&&a(`Starting new conversation with session ID: ${r}`),t.chatContainer.querySelector(".brand-header").style.display="flex",t.chatContainer.querySelector(".new-conversation").style.display="none",t.chatInterface.classList.add("active");const i=document.createElement("div");i.className="bot-typing",i.innerHTML='\n    <span class="loading-indicator"></span>\n    <span>Toratech AI is typing...</span>\n  ',t.messagesContainer.appendChild(i),setTimeout((()=>{t.messagesContainer.removeChild(i),o(t.messagesContainer,"Hello! I'm your Toratech AI Assistant. How can I help you today? Feel free to ask me any questions.","bot",a),t.textarea.focus()}),1e3)}(d,r,p,i,g)})),d.sendButton.addEventListener("click",(()=>{const t=d.textarea.value.trim();if(t){const e={...l,currentSessionId:s};c(d,t,i,g,e),d.textarea.value=""}})),d.textarea.addEventListener("keypress",(t=>{if("Enter"===t.key&&!t.shiftKey){t.preventDefault();const e=d.textarea.value.trim();if(e){const t={...l,currentSessionId:s};c(d,e,i,g,t),d.textarea.value=""}}})),d.closeButtons.forEach((t=>{t.addEventListener("click",(()=>{d.chatContainer.classList.remove("open"),d.toggleButton.focus(),g("Widget closed via click")})),t.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),d.chatContainer.classList.remove("open"),d.toggleButton.focus(),g("Widget closed via keyboard"))}))})),h=!0,g("Widget initialized"),d)}"undefined"!=typeof window&&window[e]&&(l=a({},o,window[e]));const f={init:t=>u(t),open:()=>(g("Widget.open() is disabled - widget can only be opened via the popout button","error"),!1),close:()=>h&&d?(d.chatContainer.classList.remove("open"),g("Widget closed via API"),!0):(g("Cannot close: widget not initialized","error"),!1),toggle:()=>(g("Widget.toggle() is disabled - widget can only be toggled via the popout button","error"),!1),destroy:()=>function(){if(!h)return g("Cannot destroy: widget not initialized","error"),!1;const t=document.querySelector(`.${n}`);return!!t&&(t.remove(),h=!1,d=null,g("Widget destroyed"),!0)}(),version:"1.0.0"};function b(){return console.log("[Toratech AI] Initializing widget..."),window.ChatWidgetConfig?f.init(window.ChatWidgetConfig):f.init({}),window.MyPopoutWidget=f,window[t]=f,console.log("[Toratech AI] Widget initialized and API exposed globally"),f}"undefined"!=typeof window&&(window.MyPopoutWidget=f,window[t]=f,l.advanced.autoInit&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>u())):u())),console.log("[DEBUG] src/index.js started"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b();return window.MyPopoutWidget}));
